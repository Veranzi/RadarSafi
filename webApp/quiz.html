<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz - Fraud Watch Kenya</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gray-50 min-h-screen flex flex-col font-sans">

    <header class="bg-blue-700 text-white p-4 shadow-md">
        <div class="max-w-4xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="text-2xl">üõ°Ô∏è</div>
                <div><h1 class="font-bold">Fraud Watch</h1><span class="text-xs text-blue-200">Hello, <span id="user-display-name">User</span></span></div>
            </div>
            <div class="text-right">
                <input type="password" id="api-key-input" class="px-2 py-1 rounded text-black text-xs w-32" placeholder="API Key">
                <button id="logout-btn" class="text-xs text-red-200 hover:text-white ml-2 underline">Logout</button>
            </div>
        </div>
    </header>

    <nav class="bg-white shadow-sm sticky top-0 z-10">
        <div class="max-w-4xl mx-auto flex">
            <a href="chat.html" class="flex-1 py-4 text-center font-medium text-gray-500 hover:bg-gray-50">üí¨ AI Chat</a>
            <a href="verify.html" class="flex-1 py-4 text-center font-medium text-gray-500 hover:bg-gray-50">üîç Verify</a>
            <a href="quiz.html" class="flex-1 py-4 text-center font-medium text-blue-600 border-b-2 border-blue-600">üéì Quiz</a>
        </div>
    </nav>

    <main class="max-w-4xl mx-auto p-4 flex-grow w-full">
        <div id="loading-indicator" class="hidden text-center py-2"><div class="spinner mr-2"></div></div>

        <div class="bg-white rounded-lg shadow p-6 min-h-[400px]">
            
            <div id="quiz-active">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold">Scam Quiz</h2>
                    <span id="counter" class="text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded">Q 1/4</span>
                </div>
                <div id="question-text" class="text-lg font-semibold mb-4"></div>
                <div id="options-container" class="flex flex-col gap-3"></div>
                <div id="feedback" class="mt-4 p-3 bg-gray-50 hidden rounded"></div>
                <button id="next-btn" class="mt-4 bg-blue-600 text-white px-5 py-2 rounded hidden">Next</button>
            </div>

            <div id="quiz-result" class="hidden text-center py-10">
                <div class="text-6xl mb-4">üèÜ</div>
                <h2 class="text-2xl font-bold text-gray-800 mb-2">You Scored</h2>
                <div class="text-5xl font-extrabold text-blue-600 mb-4">
                    <span id="final-score">0</span><span class="text-gray-400 text-2xl">/10</span>
                </div>
                <p id="result-msg" class="text-xl font-medium mb-8">You passed the test.</p>
                <button onclick="location.reload()" class="bg-blue-700 text-white px-8 py-3 rounded-lg font-bold hover:scale-105 transition">Try Again</button>
            </div>

        </div>
    </main>

    <script src="app.js"></script>
    <script>
        const quizData = [
            { q: "You win 9,000 via a link. What do you do?", opts: ["Click it", "Delete it"], ans: 1, why: "It is a phishing scam." },
            { q: "M-Pesa blocked. Send PIN to unblock.", opts: ["Send PIN", "Delete/Call Safaricom"], ans: 1, why: "Never share PIN." },
            { q: "Suspicious bank link?", opts: ["ncba.co.ke", "ncba-security.com"], ans: 1, why: "Fake domain." },
            { q: "KPLC asks for money to personal number.", opts: ["Pay", "Hang up"], ans: 1, why: "KPLC uses Paybills only." }
        ];

        let current = 0;
        let score = 0;

        function loadQ() {
            const q = quizData[current];
            document.getElementById('question-text').textContent = q.q;
            document.getElementById('counter').textContent = `Q ${current+1}/${quizData.length}`;
            const optsDiv = document.getElementById('options-container');
            optsDiv.innerHTML = '';
            
            q.opts.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.textContent = opt;
                btn.className = "w-full text-left p-3 border rounded hover:bg-gray-100";
                btn.onclick = () => check(idx, btn);
                optsDiv.appendChild(btn);
            });
        }

        async function check(idx, btn) {
            const q = quizData[current];
            const isCorrect = idx === q.ans;
            if(isCorrect) score++;

            // Highlight
            Array.from(document.getElementById('options-container').children).forEach((b, i) => {
                b.disabled = true;
                if(i === q.ans) b.classList.add('bg-green-100', 'border-green-500');
                else if(i === idx) b.classList.add('bg-red-100', 'border-red-500');
            });

            // Feedback
            const fb = document.getElementById('feedback');
            fb.innerHTML = `<strong>${isCorrect ? "Correct!" : "Wrong!"}</strong> ${q.why}`;
            fb.classList.remove('hidden');
            
            const next = document.getElementById('next-btn');
            next.classList.remove('hidden');
            next.onclick = () => {
                current++;
                if(current < quizData.length) {
                    fb.classList.add('hidden');
                    next.classList.add('hidden');
                    loadQ();
                } else {
                    finish();
                }
            };
        }

        function finish() {
            document.getElementById('quiz-active').classList.add('hidden');
            document.getElementById('quiz-result').classList.remove('hidden');
            
            const scaledScore = Math.round((score / quizData.length) * 10);
            document.getElementById('final-score').textContent = scaledScore;
            
            const msg = document.getElementById('result-msg');
            if(scaledScore >= 7) {
                msg.textContent = "You passed the test.";
                msg.className = "text-xl font-medium text-green-600 mb-8";
            } else {
                msg.textContent = "You failed. Try Again.";
                msg.className = "text-xl font-medium text-red-600 mb-8";
            }
        }

        loadQ();
    </script>
</body>
</html>
